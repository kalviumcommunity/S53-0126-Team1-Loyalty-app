# SmartLoyalty Flutter Architecture Guide

> **Team Reference Document** - Last updated: January 23, 2026  
> **Developers**: 2 | **Timeline**: 10 days | **Stack**: Flutter + Firebase

---

## ğŸ“ Folder Structure Overview

```
lib/
â”œâ”€â”€ main.dart                          # âš¡ App entry point (Firebase init)
â”œâ”€â”€ firebase_options.dart              # ğŸ”§ Generated by flutterfire configure
â”‚
â”œâ”€â”€ app/
â”‚   â””â”€â”€ app.dart                       # ğŸ¯ Root MaterialApp widget
â”‚
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ constants.dart                 # ğŸ¨ Colors, sizes, strings
â”‚   â”œâ”€â”€ routes.dart                    # ğŸ—ºï¸ Route names & navigation
â”‚   â””â”€â”€ theme.dart                     # ğŸ–Œï¸ ThemeData configuration
â”‚
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ providers/                     # ğŸ“Š State management
â”‚   â”‚   â”œâ”€â”€ auth_provider.dart         #    â””â”€ Auth state (login/logout)
â”‚   â”‚   â””â”€â”€ user_provider.dart         #    â””â”€ User data state
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                      # ğŸ”¥ Firebase & API logic
â”‚   â”‚   â”œâ”€â”€ auth_service.dart          #    â””â”€ Firebase Auth calls
â”‚   â”‚   â””â”€â”€ firestore_service.dart     #    â””â”€ Firestore CRUD
â”‚   â”‚
â”‚   â””â”€â”€ utils/                         # ğŸ› ï¸ Helper functions
â”‚       â”œâ”€â”€ validators.dart            #    â””â”€ Form validation
â”‚       â”œâ”€â”€ helpers.dart               #    â””â”€ Date/string formatting
â”‚       â””â”€â”€ extensions.dart            #    â””â”€ Dart extensions
â”‚
â”œâ”€â”€ models/                            # ğŸ“¦ Data classes
â”‚   â”œâ”€â”€ user_model.dart                #    â””â”€ User profile
â”‚   â”œâ”€â”€ reward_model.dart              #    â””â”€ Reward item
â”‚   â””â”€â”€ transaction_model.dart         #    â””â”€ Points transaction
â”‚
â”œâ”€â”€ features/                          # âœ¨ Feature modules
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ screens/
â”‚   â”‚   â”‚   â”œâ”€â”€ login_screen.dart
â”‚   â”‚   â”‚   â”œâ”€â”€ register_screen.dart
â”‚   â”‚   â”‚   â””â”€â”€ forgot_password_screen.dart
â”‚   â”‚   â””â”€â”€ widgets/
â”‚   â”‚       â””â”€â”€ auth_text_field.dart
â”‚   â”‚
â”‚   â”œâ”€â”€ home/
â”‚   â”‚   â”œâ”€â”€ screens/
â”‚   â”‚   â”‚   â””â”€â”€ home_screen.dart
â”‚   â”‚   â””â”€â”€ widgets/
â”‚   â”‚       â””â”€â”€ points_card.dart
â”‚   â”‚
â”‚   â”œâ”€â”€ rewards/
â”‚   â”‚   â”œâ”€â”€ screens/
â”‚   â”‚   â”‚   â”œâ”€â”€ rewards_list_screen.dart
â”‚   â”‚   â”‚   â””â”€â”€ reward_detail_screen.dart
â”‚   â”‚   â””â”€â”€ widgets/
â”‚   â”‚       â””â”€â”€ reward_card.dart
â”‚   â”‚
â”‚   â”œâ”€â”€ profile/
â”‚   â”‚   â”œâ”€â”€ screens/
â”‚   â”‚   â”‚   â””â”€â”€ profile_screen.dart
â”‚   â”‚   â””â”€â”€ widgets/
â”‚   â”‚       â””â”€â”€ profile_header.dart
â”‚   â”‚
â”‚   â””â”€â”€ splash/
â”‚       â””â”€â”€ screens/
â”‚           â””â”€â”€ splash_screen.dart
â”‚
â””â”€â”€ shared/                            # ğŸ”„ Reusable across features
    â””â”€â”€ widgets/
        â”œâ”€â”€ custom_button.dart
        â”œâ”€â”€ loading_indicator.dart
        â”œâ”€â”€ empty_state.dart
        â””â”€â”€ error_dialog.dart
```

---

## ğŸ¯ Purpose of Each Folder

| Folder | What Goes Here | Example |
|--------|---------------|---------|
| `app/` | Root app widget, providers setup | `SmartLoyaltyApp` with `MultiProvider` |
| `config/` | App-wide settings (don't change often) | Theme colors, route names, API keys |
| `core/providers/` | ChangeNotifier classes for state | `AuthProvider`, `UserProvider` |
| `core/services/` | Firebase/API calls (no UI code!) | `AuthService.signIn()` |
| `core/utils/` | Pure Dart helpers (no Flutter!) | `Validators.email()` |
| `models/` | Data classes with `fromJson`/`toJson` | `UserModel`, `RewardModel` |
| `features/X/screens/` | Full-page widgets (use Scaffold) | `LoginScreen`, `HomeScreen` |
| `features/X/widgets/` | Feature-specific UI components | `PointsCard` (only in home) |
| `shared/widgets/` | Reusable UI used across features | `CustomButton`, `LoadingIndicator` |

---

## ğŸ‘¥ Team Work Division

### Recommended Split for 2 Developers

| Developer 1 (Auth + Core) | Developer 2 (Features + UI) |
|---------------------------|---------------------------|
| `core/services/` | `features/home/` |
| `core/providers/` | `features/rewards/` |
| `features/auth/` | `features/profile/` |
| `models/` | `shared/widgets/` |
| `config/routes.dart` | `config/theme.dart` |

### PR Workflow Rules

1. **Never edit the same file** - coordinate before touching shared files
2. **Create feature branches**: `feature/auth-login`, `feature/home-screen`
3. **PR naming**: `[Feature] Add login screen` or `[Fix] Resolve points display bug`
4. **Review before merge** - other dev must approve

---

## ğŸš« Common Beginner Mistakes

### âŒ Mistake 1: Mixing UI and Business Logic
```dart
// âŒ BAD - API call inside widget
class LoginScreen extends StatelessWidget {
  void _login() async {
    await FirebaseAuth.instance.signInWithEmailAndPassword(...); // Don't do this!
  }
}

// âœ… GOOD - Use provider/service
class LoginScreen extends StatelessWidget {
  void _login(BuildContext context) {
    context.read<AuthProvider>().signIn(email, password);
  }
}
```

### âŒ Mistake 2: Hardcoding Strings
```dart
// âŒ BAD
Navigator.pushNamed(context, '/home');

// âœ… GOOD - Use route constants
Navigator.pushNamed(context, Routes.home);
```

### âŒ Mistake 3: Not Using const Constructors
```dart
// âŒ BAD - Rebuilds every time
Icon(Icons.home)

// âœ… GOOD - Optimized
const Icon(Icons.home)
```

### âŒ Mistake 4: Relative Import Chaos
```dart
// âŒ BAD - Hard to track
import '../../../core/services/auth_service.dart';

// âœ… GOOD - Absolute imports
import 'package:smartloyalty/core/services/auth_service.dart';
```

### âŒ Mistake 5: Giant Widgets
```dart
// âŒ BAD - 500 line widget
class HomeScreen extends StatelessWidget {
  // Everything crammed here...
}

// âœ… GOOD - Extract to smaller widgets
class HomeScreen extends StatelessWidget {
  Widget build(context) => Column(
    children: [
      PointsCard(),      // Separate widget
      QuickActions(),    // Separate widget
      RecentActivity(),  // Separate widget
    ],
  );
}
```

---

## âœ… Best Practices

### Naming Conventions

| Type | Convention | Example |
|------|-----------|---------|
| Files | `snake_case` | `auth_service.dart` |
| Classes | `PascalCase` | `AuthService` |
| Variables | `camelCase` | `isLoading` |
| Constants | `camelCase` | `primaryColor` |
| Private | `_prefix` | `_handleSubmit` |
| Screens | `*Screen` suffix | `LoginScreen` |
| Widgets | Descriptive noun | `PointsCard` |
| Providers | `*Provider` suffix | `AuthProvider` |
| Services | `*Service` suffix | `FirestoreService` |
| Models | `*Model` suffix | `UserModel` |

### Import Order (analysis_options enforces this)

```dart
// 1. Dart SDK
import 'dart:async';

// 2. Flutter packages
import 'package:flutter/material.dart';

// 3. Third-party packages
import 'package:provider/provider.dart';
import 'package:firebase_auth/firebase_auth.dart';

// 4. Project imports (absolute)
import 'package:smartloyalty/core/services/auth_service.dart';
import 'package:smartloyalty/models/user_model.dart';
```

### Screen Widget Template

```dart
import 'package:flutter/material.dart';
import 'package:provider/provider.dart';
import 'package:smartloyalty/core/providers/auth_provider.dart';

class FeatureScreen extends StatelessWidget {
  const FeatureScreen({super.key});

  @override
  Widget build(BuildContext context) {
    final authProvider = context.watch<AuthProvider>();

    return Scaffold(
      appBar: AppBar(title: const Text('Feature')),
      body: authProvider.isLoading
          ? const Center(child: CircularProgressIndicator())
          : _buildContent(context),
    );
  }

  Widget _buildContent(BuildContext context) {
    return const Center(child: Text('Content'));
  }
}
```

---

## ğŸ”¥ Firebase Integration Checklist

### Setup (Run Once)
```bash
# 1. Install Firebase CLI
npm install -g firebase-tools

# 2. Login
firebase login

# 3. Install FlutterFire CLI
dart pub global activate flutterfire_cli

# 4. Configure project (generates firebase_options.dart)
flutterfire configure
```

### Required Dependencies in `pubspec.yaml`
```yaml
dependencies:
  # Firebase
  firebase_core: ^3.8.1
  firebase_auth: ^5.3.4
  cloud_firestore: ^5.6.0
  
  # State Management
  provider: ^6.1.2
```

### Firestore Collections Structure
```
firestore/
â”œâ”€â”€ users/
â”‚   â””â”€â”€ {uid}/
â”‚       â”œâ”€â”€ email: string
â”‚       â”œâ”€â”€ name: string
â”‚       â”œâ”€â”€ points: number
â”‚       â”œâ”€â”€ tier: string (bronze/silver/gold)
â”‚       â””â”€â”€ createdAt: timestamp
â”‚
â”œâ”€â”€ rewards/
â”‚   â””â”€â”€ {rewardId}/
â”‚       â”œâ”€â”€ title: string
â”‚       â”œâ”€â”€ description: string
â”‚       â”œâ”€â”€ pointsCost: number
â”‚       â”œâ”€â”€ category: string
â”‚       â””â”€â”€ isActive: boolean
â”‚
â””â”€â”€ transactions/
    â””â”€â”€ {transactionId}/
        â”œâ”€â”€ userId: string
        â”œâ”€â”€ type: string (earn/redeem)
        â”œâ”€â”€ points: number
        â”œâ”€â”€ description: string
        â””â”€â”€ createdAt: timestamp
```

---

## ğŸ“‹ File Checklist (Create These)

### Core Files
- [x] `lib/core/providers/auth_provider.dart`
- [x] `lib/core/providers/user_provider.dart`
- [x] `lib/core/services/auth_service.dart`
- [x] `lib/core/services/firestore_service.dart`
- [x] `lib/core/utils/validators.dart`
- [x] `lib/core/utils/helpers.dart`
- [x] `lib/core/utils/extensions.dart`

### Shared Widgets
- [x] `lib/shared/widgets/custom_button.dart`
- [x] `lib/shared/widgets/loading_indicator.dart`
- [x] `lib/shared/widgets/empty_state.dart`
- [x] `lib/shared/widgets/error_dialog.dart`

### Feature Screens (To Create)
- [ ] `lib/features/auth/screens/login_screen.dart`
- [ ] `lib/features/auth/screens/register_screen.dart`
- [ ] `lib/features/auth/screens/forgot_password_screen.dart`
- [ ] `lib/features/home/screens/home_screen.dart`
- [ ] `lib/features/rewards/screens/rewards_list_screen.dart`
- [ ] `lib/features/rewards/screens/reward_detail_screen.dart`
- [ ] `lib/features/profile/screens/profile_screen.dart`
- [ ] `lib/features/splash/screens/splash_screen.dart`

---

## ğŸš€ Quick Commands

```bash
# Run app
flutter run

# Run with hot reload
flutter run --hot

# Build APK
flutter build apk --release

# Analyze code
flutter analyze

# Format code
dart format lib/

# Add package
flutter pub add provider

# Generate Firebase options
flutterfire configure
```

---

## ğŸ“š Recommended Learning

1. **State Management**: Watch "Flutter Provider Tutorial" on YouTube
2. **Firebase**: Firebase Flutter Codelab (firebase.google.com)
3. **Clean Architecture**: Search "Flutter Feature-First Architecture"

---

*Keep this document updated as the project evolves!*
